<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agendamiento Finisher Data ‚Äî Soporte T√©cnico</title>


  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* ===== Tema (scope .app para no chocar con Bootstrap) ===== */
    .app{
      --hue: 255;
      --primary: hsl(var(--hue) 85% 56%);
      --primary-600: hsl(var(--hue) 85% 48%);
      --primary-700: hsl(var(--hue) 85% 40%);
      --accent: hsl(18 92% 58%);
      --ok: hsl(142 72% 35%);
      --warn: hsl(41 95% 45%);
      --rose: hsl(350 78% 52%);

      --bg: hsl(220 25% 98%);
      --bg-elev: #fff;
      --text: hsl(222 47% 12%);
      --muted: hsl(222 12% 40%);
      --ring: hsl(220 16% 86%);
      --border: hsl(220 16% 88%);
      --shadow: 0 12px 28px hsl(220 50% 2% / .10);

      --radius-xl: 16px;
      --radius: 14px;
      --radius-sm: 12px;
      --focus: 0 0 0 4px color-mix(in oklab, var(--primary) 25%, transparent);
    }
    @media (prefers-color-scheme: dark){
      .app{
        --bg: hsl(224 16% 12%);
        --bg-elev: hsl(224 14% 16%);
        --text: hsl(0 0% 98%);
        --muted: hsl(225 11% 72%);
        --ring: hsl(225 10% 28%);
        --border: hsl(225 10% 26%);
        --shadow: 0 16px 36px hsl(220 60% 2% / .45);
      }
    }

    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 0% -10%, color-mix(in oklab, var(--primary) 18%, var(--bg) 82%), transparent 60%),
        radial-gradient(900px 600px at 120% 0%, color-mix(in oklab, var(--accent) 14%, var(--bg) 86%), transparent 60%),
        var(--bg);
      color:var(--text);
      font:15px/1.55 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
    }

    /* ===== Layout ===== */
    .app .container{max-width:1100px;margin:0 auto;padding:28px}
    .app .row{display:flex;gap:18px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .app .kicker{color:var(--muted)}
    .app h1{font-size:clamp(24px,3.4vw,34px);margin:0 0 6px}
    .app h2{font-size:clamp(20px,2.4vw,24px);margin:0 0 2px}
    .app h3{font-size:16px;margin:0}

    /* ===== Cards ===== */
    .app .card{background:var(--bg-elev);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--shadow)}
    .app .card .content{padding:18px}

    /* ===== Chips/Pills ===== */
    .app .pill{
      display:inline-flex;align-items:center;gap:6px;
      border-radius:999px;padding:6px 10px;font-size:12px;
      background:color-mix(in oklab, var(--primary) 12%, var(--bg-elev) 88%);
      color:color-mix(in oklab, var(--primary) 70%, black 30%);
      border:1px solid color-mix(in oklab, var(--primary) 18%, var(--border) 82%);
    }
    .app .pill.gray{
      background:color-mix(in oklab, var(--text) 6%, var(--bg-elev) 94%);
      color:var(--muted);
      border:1px solid var(--border);
    }
    .app .pill.ok{
      background:color-mix(in oklab, var(--ok) 16%, var(--bg-elev) 84%);
      color:color-mix(in oklab, var(--ok) 70%, black 30%);
      border:1px solid color-mix(in oklab, var(--ok) 24%, var(--border) 76%);
    }
    .app .pill.warn{
      background:color-mix(in oklab, var(--warn) 16%, var(--bg-elev) 84%);
      color:color-mix(in oklab, var(--warn) 70%, black 30%);
      border:1px solid color-mix(in oklab, var(--warn) 24%, var(--border) 76%);
    }

    /* ===== Dots de rol ===== */
    .app .dot{width:12px;height:12px;border-radius:50%;box-shadow:0 0 0 3px color-mix(in oklab, var(--primary) 10%, transparent)}
    .app .bg-indigo{background:var(--primary)}
    .app .bg-emerald{background:hsl(160 84% 35%)}
    .app .bg-amber{background:hsl(41 95% 45%)}
    .app .bg-rose{background:var(--rose)}

    /* ===== Inputs y botones ===== */
    .app select,.app button,.app input{font:inherit}
    .app select,.app input{
      border:1px solid var(--ring);
      background:var(--bg-elev);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease, transform .06s ease;
    }
    .app select:focus,.app input:focus{
      border-color: color-mix(in oklab, var(--primary) 40%, var(--ring) 60%);
      box-shadow: var(--focus);
    }
    .app button{
      border:1px solid var(--ring);
      background:var(--bg-elev);
      color:var(--text);
      border-radius:12px;
      padding:10px 14px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 8px 18px hsl(220 40% 2% / .08);
      transition: transform .08s ease, filter .15s ease, background .15s ease, border-color .15s ease;
    }
    .app button:hover{filter:saturate(1.05)}
    .app button:active{transform:translateY(1px)}
    .app button:focus-visible{outline:none; box-shadow: var(--focus);}
    .app button.primary{background:var(--primary);color:white;border-color:transparent}
    .app button.primary:hover{background:var(--primary-600)}
    .app button.primary:active{background:var(--primary-700)}
    .app button.ghost{
      background:transparent;color:var(--primary);
      border-color:color-mix(in oklab, var(--primary) 35%, var(--ring) 65%);
    }
    .app button.ghost:hover{
      background:color-mix(in oklab, var(--primary) 6%, transparent);
      border-color:color-mix(in oklab, var(--primary) 50%, var(--ring) 50%);
    }

    /* ===== Items (l√≠neas) ===== */
    .app .item{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      padding:14px;border:1px solid var(--border);border-radius:14px;background:var(--bg-elev);
      transition: border-color .15s ease, box-shadow .15s ease, transform .06s ease;
    }
    .app .item:hover{
      border-color: color-mix(in oklab, var(--primary) 18%, var(--border) 82%);
      box-shadow:0 10px 24px hsl(220 50% 2% / .10);
    }
    .app .muted{color:var(--muted)}

    /* ===== Tabs ===== */
    .app .tabs{
      display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:14px;
      background:color-mix(in oklab, var(--text) 6%, var(--bg-elev) 94%);
      padding:6px;border-radius:14px;border:1px solid var(--border);
    }
    .app .tab{
      border:1px solid transparent;
      background:transparent;color:var(--muted);
      border-radius:10px;padding:10px;text-align:center;cursor:pointer;user-select:none;
      transition: background .15s ease, color .15s ease, border-color .15s ease, transform .06s ease;
    }
    .app .tab:hover{color:var(--text);background:color-mix(in oklab, var(--text) 6%, transparent)}
    .app .tab[aria-selected="true"]{
      background:linear-gradient(180deg, color-mix(in oklab, var(--primary) 10%, var(--bg-elev) 90%), var(--bg-elev));
      color:var(--text);
      border-color: color-mix(in oklab, var(--primary) 25%, var(--border) 75%);
      box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--primary) 20%, transparent);
    }
    .app .tab:active{transform:translateY(1px)}
    .app .tabpanes{margin-top:16px}

    /* ===== Grids ===== */
    .app .grid{display:grid;gap:12px}
    .app .grid.two{grid-template-columns:repeat(2,minmax(0,1fr))}
    .app .grid.three{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width: 860px){.app .grid.two,.app .grid.three{grid-template-columns:1fr}}

    /* ===== Footer ===== */
    .app .footer{color:var(--muted);text-align:center;padding:14px;margin-top:14px;border-top:1px dashed var(--border)}

    /* ===== Finisher Data ‚Äì ambient branding ===== */
    .app .brand-hero.card{overflow:hidden; position:relative}
    .app .brand-hero .side-image{
      min-height: 260px; border-radius: 14px;
      background-position:center; background-size:cover;
    }
    .app .brand-hero .badge-soft{
      display:inline-block; padding:.35rem .6rem; border-radius:999px;
      background: color-mix(in oklab, var(--primary) 12%, var(--bg-elev) 88%);
      border:1px solid color-mix(in oklab, var(--primary) 20%, var(--border) 80%);
      color: color-mix(in oklab, var(--primary) 70%, black 30%); font-weight:600; font-size:.85rem;
    }
    .app .brand-hero .list-check{list-style:none; padding-left:0; margin:0}
    .app .brand-hero .list-check li{display:flex; gap:.6rem; align-items:flex-start; margin:.35rem 0}
    .app .brand-hero .list-check .check{
      width:22px; height:22px; flex:0 0 22px; border-radius:6px;
      background: var(--ok); display:grid; place-items:center; color:#fff; font-size:14px;
      box-shadow: 0 6px 14px hsl(140 60% 20% / .28);
    }

    .app .brand-logos{display:flex; gap:.6rem; flex-wrap:wrap}
    .app .logo-pill{
      background:var(--bg-elev); border:1px solid var(--border); border-radius:999px;
      padding:.45rem .8rem; display:flex; align-items:center; gap:.5rem;
      box-shadow: 0 6px 14px hsl(220 40% 2% / .06);
    }
    .app .logo-pill img{width:22px; height:22px; object-fit:contain; border-radius:4px}

    .app .gallery{display:grid; gap:12px; grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width: 860px){ .app .gallery{grid-template-columns:1fr} }
    .app .gallery .gcard{overflow:hidden}
    .app .gallery .gimg{height:180px; width:100%; object-fit:cover; border-radius:12px}

    .app .stats{display:grid; gap:10px; grid-template-columns:repeat(4,minmax(0,1fr))}
    @media (max-width: 860px){ .app .stats{grid-template-columns:repeat(2,1fr)} }
    .app .stat{
      background:var(--bg-elev); border:1px solid var(--border); border-radius:14px; padding:14px;
      display:flex; flex-direction:column; gap:2px; text-align:center;
    }
    .app .stat .num{font-size:1.3rem; font-weight:800}
    .app .stat .lbl{color:var(--muted); font-size:.9rem}

    /* Imagen lateral responsive */
    .app .side-image{
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 10;
      overflow: hidden;
      border-radius: 14px;
      box-shadow: 0 10px 24px hsl(220 50% 2% / .10);
      background: var(--bg-elev);
    }
    .app .side-image img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    @media (min-width: 1200px){
      .app .side-image{ aspect-ratio: 16 / 9; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="container">

      <!-- NAVBAR MEN√ö ROLES -->
      <nav class="navbar navbar-expand-lg navbar-light bg-light rounded-3 shadow-sm mb-3">
        <div class="container-fluid">
          <a class="navbar-brand fw-bold" href="index.html">Finisher Data</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarRoles">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarRoles">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link " href="index.html">Administrador</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="operador.html">Operador t√©cnico</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="organizador.html">Organizador del evento</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="soporte.html">Soporte t√©cnico</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Header -->
      <div class="row">
        <div style="max-width:700px">
          <h1 class="fw-bold">Software de Agendamiento ‚Äî Rol: Soporte T√©cnico</h1>

          <p class="kicker">Integra calendario de eventos con disponibilidad de recursos, env√≠a notificaciones autom√°ticas y genera reportes anal√≠ticos. Optimiza la comunicaci√≥n interna y anticipa conflictos de programaci√≥n.</p>
        </div>
        <div class="row">
          <!-- Dot de color del rol -->
          <div id="roleColor" class="dot bg-indigo ms-2"></div>
        </div>
      </div>

      <!-- ===== Finisher Data ‚Äì Ambiente de marca ===== -->
      <!-- <div class="card brand-hero mt-3">
        <div class="content">
          <div class="row" style="align-items:stretch">
            <!-- Texto -->
            <!-- <div style="flex:1 1 520px; min-width:280px">
              <span class="badge-soft">Finisher Data</span>
              <h2 class="fw-bold mt-2">Tecnolog√≠a para eventos de alto rendimiento</h2>
              <p class="kicker">Cronometraje, RFID, anal√≠tica en tiempo real y orquestaci√≥n log√≠stica para competencias masivas.</p>

              <ul class="list-check mt-2">
                <li><span class="check">‚úì</span><div><b>Experiencia en campo:</b> triatlones, maratones y OCR con m√∫ltiples puntos de control.</div></li>
                <li><span class="check">‚úì</span><div><b>Stack de datos:</b> ingesti√≥n en vivo, dashboards de desempe√±o y reportes ejecutivos.</div></li>
                <li><span class="check">‚úì</span><div><b>Operaci√≥n confiable:</b> asignaciones por rol, alertas y resoluci√≥n de conflictos.</div></li>
              </ul>

              <div class="brand-logos mt-3">
                <span class="logo-pill"><img src="img/andesrace.png" alt="run"><span>Races</span></span>
                <span class="logo-pill"><img src="img/rfid.jpg" alt="rfid"><span>RFID/UHF</span></span>
                <span class="logo-pill"><img src="img/analitis.png" alt="analytics"><span>Analytics</span></span>
                <span class="logo-pill"><img src="img/cloud.jpg" alt="cloud"><span>Cloud</span></span>
              </div>

              <div class="mt-3 d-flex gap-2 flex-wrap">
                <button class="primary">Con√≥cenos</button>
                <button class="ghost">Contacto</button>
              </div>
            </div>

            <!--  Imagen lateral -->
            <!-- <div style="flex:1 1 320px; min-width:260px">
              <div class="side-image"><img src="img/triatlon_portada.jpg" alt=""></div>
            </div>
          </div>
        </div>
      </div> --> --> -->

      <!-- Stats -->
      <!-- <div class="stats mt-3">
        <div class="stat"><div class="num">+200</div><div class="lbl">Eventos cronometrados</div></div>
        <div class="stat"><div class="num">99.9%</div><div class="lbl">Uptime de servicios</div></div>
        <div class="stat"><div class="num">~80K</div><div class="lbl">Participantes/a√±o</div></div>
        <div class="stat"><div class="num">5</div><div class="lbl">Pa√≠ses soporte</div></div>
      </div> -->

      <!-- Galer√≠a -->
      <!-- <div class="gallery mt-3">
        <div class="card gcard">
          <img class="gimg" src="img/meta.jpg" alt="P√≥rtico de meta">
          <div class="content">
            <h3 class="fw-semibold">P√≥rtico de meta & antenas UHF</h3>
            <p class="muted mt-1">Lecturas confiables en puntos de alto flujo.</p>
          </div>
        </div>
        <div class="card gcard">
          <img class="gimg" src="img/resultados.jpg" alt="Cronometraje y resultados">
          <div class="content">
            <h3 class="fw-semibold">Cronometraje y splits</h3>
            <p class="muted mt-1">Tiempos intermedios y ranking en vivo.</p>
          </div>
        </div>
        <div class="card gcard">
          <img class="gimg" src="img/centro.jpg" alt="Centro de control">
          <div class="content">
            <h3 class="fw-semibold">Centro de control</h3>
            <p class="muted mt-1">Alertas, asignaciones y resoluci√≥n de incidencias.</p>
          </div>
        </div>
      </div> -->

      <!-- Rol summary -->
      <div class="card mt-3">
        <div class="content row">
          <div style="max-width:700px">
            <h2 id="roleName" class="fw-semibold">Administrador</h2>
            <p id="roleDesc" class="kicker">Supervisa y gestiona la planificaci√≥n‚Ä¶</p>
          </div>
          <div class="row" style="gap:8px">
            <span class="pill">Calendario</span>
            <span class="pill">Recursos</span>
            <span class="pill">Notificaciones</span>
            <span class="pill">Reportes</span>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs" role="tablist" aria-label="Secciones">
        <button class="tab" role="tab" aria-selected="true" data-tab="calendario">Calendario</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="recursos">Recursos</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="tareas">Tareas</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="reportes">Reportes</button>
      </div>

      <div class="tabpanes">
        <!-- Calendario -->
        <section id="pane-calendario" hidden>
          <div class="card">
            <div class="content row">
              <div class="row" style="gap:8px">
                <button id="btnNuevoEvento" class="primary">Nuevo evento</button>
                <input id="buscarEventos" placeholder="Buscar‚Ä¶" class="form-control" style="width:220px" />
              </div>
            </div>
          </div>
          <div class="grid two" id="listaEventos" style="margin-top:12px"></div>

          <div class="card" style="margin-top:12px">
            <div class="content grid three" id="notis"></div>
          </div>
        </section>

        <!-- Recursos -->
        <section id="pane-recursos" hidden>
          <div class="card">
            <div class="content row">
              <h3 class="fw-semibold">Disponibilidad de recursos</h3>
              <button id="btnGestionCatalogo" class="ghost">Gestionar cat√°logo</button>
            </div>
          </div>
          <div class="grid three" id="listaRecursos" style="margin-top:12px"></div>
        </section>

        <!-- Tareas -->
        <section id="pane-tareas" hidden>
          <div class="card">
            <div class="content row">
              <h3 class="fw-semibold">Gesti√≥n de tareas</h3>
              <div class="row">
                <input id="nuevaTarea" placeholder="Nueva tarea‚Ä¶" class="form-control" style="width:260px" />
                <button id="btnCrearTarea" class="primary">Crear</button>
              </div>
            </div>
          </div>
          <div class="grid two" id="listaTareas" style="margin-top:12px"></div>
        </section>

        <!-- Reportes -->
        <section id="pane-reportes" hidden>
          <div class="grid three" id="listaReportes"></div>
        </section>
      </div>

      <div class="footer">Vista de demostraci√≥n ‚Äî este archivo est√° fijado al rol Administrador.</div>
    </div>
  </div>

  <!-- ===== JS (adaptado a un solo rol por archivo) ===== -->
  <script>
    // üëâ AQU√ç FIJAS EL ROL DEL ARCHIVO
    const CURRENT_ROLE_ID = 'soporte';


    const ROLES = [
      {id:'admin', nombre:'Administrador', color:'bg-indigo', desc:'Supervisa la planificaci√≥n. Crea eventos, asigna operadores, gestiona reuniones y genera reportes.', perms:{nuevoEvento:true, gestionarCatalogo:true, asignar:true, exportar:true}},
      {id:'operador', nombre:'Operador T√©cnico', color:'bg-emerald', desc:'Instala y opera cronometraje, RFID, antenas, etc. Acepta tareas y notifica incidencias.', perms:{nuevoEvento:false, gestionarCatalogo:false, asignar:false, aceptarTarea:true}},
      {id:'organizador', nombre:'Organizador del Evento', color:'bg-amber', desc:'Cliente/socio que contrata servicios. Programa reuniones, consulta asignaciones y descarga reportes.', perms:{nuevoEvento:true, gestionarCatalogo:false, asignar:false, exportar:true}},
      {id:'soporte', nombre:'Soporte T√©cnico / Cronometraje', color:'bg-rose', desc:'Especialistas de campo. Visualizan asignaciones de cronometraje y puntos de control.', perms:{nuevoEvento:false, gestionarCatalogo:false, aceptarTarea:true}}
    ];

    let eventos = [
      { id:'EVT-2411', nombre:'Marat√≥n Ciudad 10K', fecha:'2025-12-01 07:30', estado:'Planificado' },
      { id:'EVT-2412', nombre:'Triatl√≥n Costa Norte', fecha:'2025-12-10 06:00', estado:'En revisi√≥n' },
    ];
    let recursos = [
      { id:1, nombre:'Kit RFID #1', tipo:'RFID', disponible:true },
      { id:2, nombre:'Antenas UHF (x4)', tipo:'Antena', disponible:false },
      { id:3, nombre:'Cron√≥metro Pro', tipo:'Cronometraje', disponible:true },
    ];
    let tareas = [
      { id:'T-101', titulo:'Montaje antenas zona meta', rol:'operador', prioridad:'Alta', estado:'Pendiente' },
      { id:'T-102', titulo:'Ruta 5K ‚Äî puntos de control', rol:'soporte', prioridad:'Media', estado:'Pendiente' },
    ];
    let notificaciones = [
      { titulo:'Conflicto detectado', texto:'El recurso "Antenas UHF (x4)" ya est√° reservado el 01/12.' },
      { titulo:'Tarea aceptada', texto:'Operador asignado al montaje de zona de meta.' },
      { titulo:'Agenda actualizada', texto:'Reuni√≥n con organizador movida a 29/11 18:00.' },
    ];
    const reportes = [
      { id:'R1', titulo:'Utilizaci√≥n de recursos', texto:'Tasa de ocupaci√≥n semanal por tipo (RFID, antenas, cronometraje).'},
      { id:'R2', titulo:'Rendimiento de tareas', texto:'Tiempos de respuesta, incidencias resueltas y SLAs por rol.'},
      { id:'R3', titulo:'Calendario y conflictos', texto:'Choques de agenda detectados y reprogramaciones autom√°ticas.'},
    ];

    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>[...root.querySelectorAll(s)];
    function csv(rows){return rows.map(r=>r.map(v=>`"${String(v).replaceAll('"','""')}"`).join(',')).join('\n')}
    function download(filename, content, mime='text/plain'){
      const blob = new Blob([content], {type:mime});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
    }
    function toast(msg){console.log('[INFO]', msg); alert(msg);}

    function getCurrentRole(){
      return ROLES.find(x=>x.id===CURRENT_ROLE_ID);
    }

    function setRoleUI(roleId){
      const r = ROLES.find(x=>x.id===roleId);
      if(!r) return;
      $('#roleName').textContent = r.nombre;
      $('#roleDesc').textContent = r.desc;
      $('#roleColor').className = `dot ${r.color}`;
      // permisos visibles
      $('#btnNuevoEvento').style.display = r.perms.nuevoEvento ? '' : 'none';
      $('#btnGestionCatalogo').style.display = r.perms.gestionarCatalogo ? '' : 'none';
      $('#btnCrearTarea').style.display = r.id==='admin' ? '' : 'none';
      renderEventos(r); renderRecursos(r); renderTareas(r); renderNotificaciones(); renderReportes(r);
    }

    function renderEventos(role){
      const cont = $('#listaEventos'); cont.innerHTML = '';
      const query = ($('#buscarEventos')?.value||'').toLowerCase();
      eventos
        .filter(e => e.nombre.toLowerCase().includes(query) || e.id.toLowerCase().includes(query))
        .forEach(e=>{
          const el = document.createElement('div');
          el.className = 'item';
          el.innerHTML = `
            <div>
              <div style="font-weight:600">${e.nombre} <span class="muted">(${e.id})</span></div>
              <div class="muted mt-1">${e.fecha}</div>
              <div class="mt-2"><span class="pill">${e.estado}</span></div>
            </div>
            ${ (role.perms.nuevoEvento) ? `<button class="ghost" data-action="gestionar-evento" data-id="${e.id}">Gestionar</button>` : '' }
          `;
          cont.appendChild(el);
        });
    }

    function renderNotificaciones(){
      const cont = $('#notis'); cont.innerHTML='';
      notificaciones.forEach(n=>{
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = `<div><div style="font-weight:600">${n.titulo}</div><div class="muted mt-1">${n.texto}</div></div>`;
        cont.appendChild(el);
      })
    }

    function renderRecursos(role){
      const cont = $('#listaRecursos'); cont.innerHTML='';
      recursos.forEach(r=>{
        const el = document.createElement('div'); el.className = 'item';
        const estado = r.disponible ? '<span class="pill ok">Disponible</span>' : '<span class="pill gray">Reservado</span>';
        const btn = (role.id==='admin' || role.id==='organizador') ? `<button class="primary" data-action="asignar-recurso" data-id="${r.id}">Asignar a evento</button>` : '';
        el.innerHTML = `<div><div style="font-weight:600">${r.nombre}</div><div class="muted mt-1">${r.tipo}</div><div class="mt-2">${estado}</div></div>${btn}`;
        cont.appendChild(el);
      })
    }

    function renderTareas(role){
      const cont = $('#listaTareas'); cont.innerHTML='';
      tareas.forEach(t=>{
        const puedeAceptar = (role.id==='operador' || role.id==='soporte');
        const label = (t.estado==='Aceptada') ? 'Aceptada' : (puedeAceptar ? 'Aceptar' : 'Asignar');
        const el = document.createElement('div'); el.className = 'item';
        el.innerHTML = `<div>
            <div style="font-weight:600">${t.titulo}</div>
            <div class="muted mt-1">Rol: <b>${t.rol}</b></div>
            <div class="mt-2"><span class="pill">Prioridad ${t.prioridad}</span></div>
          </div>` + (t.estado==='Aceptada'
            ? `<span class="pill ok">${label}</span>`
            : `<button class="ghost" data-action="tarea-${puedeAceptar?'aceptar':'asignar'}" data-id="${t.id}">${label}</button>`);
        cont.appendChild(el);
      })
    }

    function renderReportes(role){
      const cont = $('#listaReportes'); cont.innerHTML='';
      reportes.forEach(r=>{
        const el = document.createElement('div'); el.className = 'item';
        el.innerHTML = `<div><div style="font-weight:600">${r.titulo}</div><div class="muted mt-1">${r.texto}</div></div>${ (role.perms.exportar?`<button class="primary" data-action="exportar" data-id="${r.id}">Exportar</button>`:'') }`;
        cont.appendChild(el);
      })
    }

    function activateTab(name){
      $$('.tab').forEach(btn=>btn.setAttribute('aria-selected', String(btn.dataset.tab===name)));
      $$('#pane-calendario, #pane-recursos, #pane-tareas, #pane-reportes').forEach(p=>p.hidden = !p.id.endsWith(name));
    }

    (function init(){
      // Tabs
      $$('.tab').forEach(btn=>btn.addEventListener('click',()=>activateTab(btn.dataset.tab)));
      activateTab('calendario');

      // Crear tarea
      $('#btnCrearTarea').addEventListener('click',()=>{
        const v = $('#nuevaTarea').value.trim(); if(!v) return;
        tareas = [{ id:'T-'+Math.floor(Math.random()*900+100), titulo:v, rol:'operador', prioridad:'Media', estado:'Pendiente'}, ...tareas];
        $('#nuevaTarea').value='';
        setRoleUI(CURRENT_ROLE_ID);
      });

      // Nuevo evento
      $('#btnNuevoEvento').addEventListener('click',()=>{
        const nombre = prompt('Nombre del evento:'); if(!nombre) return;
        const fecha = prompt('Fecha y hora (YYYY-MM-DD HH:mm):','2025-12-20 07:00'); if(!fecha) return;
        const id = 'EVT-'+Math.floor(Math.random()*9000+1000);
        eventos = [{id, nombre, fecha, estado:'Planificado'}, ...eventos];
        notificaciones = [{titulo:'Nuevo evento', texto:`Se cre√≥ ${nombre} (${id}).`} , ...notificaciones];
        setRoleUI(CURRENT_ROLE_ID); toast('Evento creado');
      });

      // B√∫squeda de eventos
      $('#buscarEventos').addEventListener('input', ()=> renderEventos(getCurrentRole()) );

      // Gesti√≥n de cat√°logo
      $('#btnGestionCatalogo').addEventListener('click',()=>{
        const modo = prompt('Escribe: 1) agregar  2) toggle (cambiar disponibilidad)');
        if(modo==='1'){
          const nombre = prompt('Nombre del recurso:'); if(!nombre) return;
          const tipo = prompt('Tipo (RFID/Antena/Cronometraje):','RFID'); if(!tipo) return;
          const id = (recursos.at(-1)?.id||0)+1; recursos.push({id, nombre, tipo, disponible:true}); toast('Recurso agregado');
        } else if(modo==='2'){
          const id = Number(prompt('ID del recurso a cambiar:')); if(!id) return;
          const r = recursos.find(x=>x.id===id); if(!r) return toast('No existe ese recurso');
          r.disponible = !r.disponible; toast(`Recurso ${id} ahora ${r.disponible?'Disponible':'Reservado'}`);
        }
        setRoleUI(CURRENT_ROLE_ID);
      });

      // Delegaci√≥n de clicks
      document.body.addEventListener('click', (e)=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const action = btn.dataset.action; if(!action) return;
        const role = getCurrentRole();

        if(action==='asignar-recurso'){
          const id = Number(btn.dataset.id);
          const recurso = recursos.find(x=>x.id===id); if(!recurso) return;
          const evId = prompt(`Asignar ${recurso.nombre} a evento (ID):`, eventos[0]?.id||''); if(!evId) return;
          const ev = eventos.find(e=>e.id===evId); if(!ev) return toast('Evento no encontrado');
          recurso.disponible = false; notificaciones = [{titulo:'Recurso asignado', texto:`${recurso.nombre} asignado a ${ev.nombre} (${ev.id}).`}, ...notificaciones];
          setRoleUI(CURRENT_ROLE_ID); toast('Recurso asignado');
        }
        if(action==='gestionar-evento'){
          const id = btn.dataset.id;
          const ev = eventos.find(e=>e.id===id); if(!ev) return;
          const nuevoEstado = prompt('Estado (Planificado/En revisi√≥n/Confirmado/Finalizado):', ev.estado) || ev.estado;
          const nuevaFecha = prompt('Fecha y hora (YYYY-MM-DD HH:mm):', ev.fecha) || ev.fecha;
          ev.estado = nuevoEstado; ev.fecha = nuevaFecha; toast('Evento actualizado'); setRoleUI(CURRENT_ROLE_ID);
        }
        if(action==='tarea-aceptar'){
          const id = btn.dataset.id; const t = tareas.find(x=>x.id===id); if(!t) return;
          t.estado = 'Aceptada'; notificaciones = [{titulo:'Tarea aceptada', texto:`${t.titulo} (${t.id}) fue aceptada.`}, ...notificaciones];
          setRoleUI(CURRENT_ROLE_ID);
        }
        if(action==='tarea-asignar'){
          const id = btn.dataset.id; const t = tareas.find(x=>x.id===id); if(!t) return;
          const rol = prompt('Asignar a rol (operador/soporte):', t.rol) || t.rol;
          t.rol = rol; toast('Tarea reasignada'); setRoleUI(CURRENT_ROLE_ID);
        }
        if(action==='exportar'){
          const id = btn.dataset.id;
          if(id==='R1'){
            const rows = [['Tipo','Disponible'], ...recursos.map(r=>[r.tipo+': '+r.nombre, r.disponible?'S√≠':'No'])];
            download('utilizacion_recursos.csv', csv(rows), 'text/csv');
          } else if(id==='R2'){
            const rows = [['ID','Titulo','Rol','Prioridad','Estado'], ...tareas.map(t=>[t.id,t.titulo,t.rol,t.prioridad,t.estado||'Pendiente'])];
            download('rendimiento_tareas.csv', csv(rows), 'text/csv');
          } else if(id==='R3'){
            const rows = [['ID','Nombre','Fecha','Estado'], ...eventos.map(e=>[e.id,e.nombre,e.fecha,e.estado])];
            download('calendario_conflictos.csv', csv(rows), 'text/csv');
          }
          toast('Reporte exportado');
        }
      });

      // Inicializa UI con el rol fijo de este archivo
      setRoleUI(CURRENT_ROLE_ID);
    })();
  </script>

  <!-- Bootstrap bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
